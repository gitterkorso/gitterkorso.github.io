<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nick Westin</title>
  <!-- Favicon med initialer NW som SVG-data-URL -->
  <link rel="icon" type="image/svg+xml" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="12" fill="%230077B5"/><text x="50%" y="54%" text-anchor="middle" font-size="36" font-family="Arial, sans-serif" fill="white" dy=".1em">NW</text></svg>' />
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background: #f9f9f9;
      color: #222;
      transition: background 0.3s, color 0.3s;
    }
    button {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
    }
    pre {
      background: #eee;
      padding: 1rem;
      margin-top: 1rem;
    }
    nav {
      margin-bottom: 1rem;
    }
    .tablink {
      padding: 0.5rem 1rem;
      margin-right: 0.5rem;
      cursor: pointer;
      background: #ddd;
      border: none;
      font-weight: bold;
      transition: background 0.2s, transform 0.1s cubic-bezier(.4,2,.3,1);
    }
    .tablink:active {
      transform: scale(0.93);
    }
    .tablink:hover {
      background: #ccc;
    }
    .tabcontent {
      display: none;
      background: #eee;
      padding: 1rem;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s cubic-bezier(.4,2,.3,1), transform 0.5s cubic-bezier(.4,2,.3,1);
    }
    .tabcontent.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    .clock {
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 1rem;
      background: #ddd;
      color: #222;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
    }
    /* Social links container */
    .social-links {
      position: absolute;
      top: 10px;
      left: 20px;
      display: flex;
      gap: 16px;
      z-index: 10;
    }
    .social-links a {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
    }
    .social-icon, .youtube-icon {
      width: 100%;
      height: 100%;
      transition: transform 0.2s;
      display: block;
    }
    .social-icon:hover, .youtube-icon:hover {
      transform: scale(1.1);
    }
    /* Ta bort gamla positioneringar */
    #youtube-link, #github-link, #linkedin-link {
      position: static;
      left: unset;
      top: unset;
    }
    /* Språkväxlare uppe till höger */
    .lang-switcher {
      position: absolute;
      top: 10px;
      right: 130px; /* Flytta till vänster om klockan */
      display: flex;
      gap: 10px;
      z-index: 20;
    }
    .lang-flag {
      background: none;
      border: none;
      padding: 0;
      margin: 0 2px;
      cursor: pointer;
      width: 36px;
      height: 24px;
      border-radius: 4px;
      transition: border 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .lang-flag.selected {
      border: 2px solid #0077B5;
    }
    .lang-flag img {
      width: 32px;
      height: 22px;
      border-radius: 3px;
      display: block;
    }
    @media (prefers-color-scheme: dark) {
      body {
        background: #181a1b;
        color: #f1f1f1;
      }
      .tabcontent {
        background: #23272a;
        color: #f1f1f1;
      }
      .clock {
        background: #23272a;
        color: #f1f1f1;
      }
      .tablink {
        background: #23272a;
        color: #f1f1f1;
      }
      pre {
        background: #23272a;
        color: #f1f1f1;
      }
      .lang-flag {
        background: #23272a;
      }
    }
    /* Subtil animerad bakgrund med svart/grå skala */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      z-index: 0;
      pointer-events: none;
      background: radial-gradient(circle at 20% 30%, #444 0%, transparent 60%),
                  radial-gradient(circle at 80% 70%, #222 0%, transparent 60%),
                  radial-gradient(circle at 60% 20%, #888 0%, transparent 60%);
      opacity: 0.22;
      animation: bgMove 16s ease-in-out infinite alternate;
    }
    @keyframes bgMove {
      0% {
        background-position:
          20% 30%,
          80% 70%,
          60% 20%;
      }
      100% {
        background-position:
          25% 35%,
          75% 65%,
          65% 25%;
      }
    }
    body { position: relative; z-index: 1; }

    /* Progress bar för studier */
    .progress-container {
      margin: 2rem 0 1.5rem 0;
      background: #e0e0e0;
      border-radius: 1rem;
      height: 28px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.07);
      position: relative;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #6ec1e4, #b06ee4);
      border-radius: 1rem 0 0 1rem;
      width: 60% !important;
      color: #fff;
      font-weight: bold;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 1rem;
      transition: none;
      box-sizing: border-box;
    }
    .progress-label {
      margin-bottom: 0.5rem;
      font-size: 1.05rem;
      font-weight: 500;
    }
    /* Dagens datum */
    .date-today {
      position: absolute;
      top: 10px;
      right: 220px;
      margin: 0;
      font-size: 1.05rem;
      font-weight: 500;
      color: #6ec1e4;
      letter-spacing: 0.5px;
      background: rgba(255,255,255,0.85);
      padding: 0.3em 0.9em;
      border-radius: 0.7em;
      z-index: 21;
      box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    }
    @media (prefers-color-scheme: dark) {
      .date-today {
        background: #23272a;
        color: #6ec1e4;
      }
    }
    /* Fyrverkeri canvas */
    #fireworks-canvas {
      position: fixed;
      left: 0; top: 0; width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 9999;
    }
    /* Rita-på-sidan canvas */
    #draw-canvas {
      position: fixed;
      left: 0; top: 0; width: 100vw; height: 100vh;
      pointer-events: none;
      z-index: 9998;
    }
    /* Partikeleffekt canvas */
    #particles-bg {
      position: fixed;
      left: 0; top: 0; width: 100vw; height: 100vh;
      z-index: 0;
      pointer-events: none;
      opacity: 0.45;
    }
    h1#main-title {
      display: inline-block;
      min-height: unset;
      margin-bottom: 0.2em;
      letter-spacing: 1.5px;
      font-size: 2.5rem;
      font-family: inherit;
      white-space: pre;
      overflow: hidden;
      line-height: 1.1;
      vertical-align: middle;
    }
    .wave-letter {
      display: inline-block;
      animation: wave 1.2s 1;
      animation-delay: calc(var(--i) * 0.08s);
    }
    @keyframes wave {
      0% { transform: translateY(0); }
      20% { transform: translateY(-0.35em); }
      40%, 100% { transform: translateY(0); }
    }
    .canvas-hint {
      position: fixed;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      background: rgba(40,40,40,0.92);
      color: #fff;
      font-size: 1rem;
      padding: 0.5em 1.2em;
      border-radius: 1.2em;
      box-shadow: 0 2px 8px rgba(0,0,0,0.13);
      z-index: 10000;
      pointer-events: none;
      opacity: 0.92;
      transition: opacity 0.5s;
    }
    .canvas-hint.hide {
      opacity: 0;
      transition: opacity 0.5s;
    }
    .clear-drawing-btn {
      position: fixed;
      bottom: 90px;
      right: 32px;
      z-index: 10001;
      background: #fff;
      color: #0077B5;
      border: 2px solid #0077B5;
      border-radius: 2em;
      padding: 0.5em 1.3em;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.10);
      transition: background 0.2s, color 0.2s, border 0.2s;
    }
    .clear-drawing-btn:hover {
      background: #0077B5;
      color: #fff;
      border: 2px solid #005580;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
</head>
<body>
    <div class="social-links">
      <a href="https://www.youtube.com/@nickwestin3967" target="_blank" id="youtube-link" aria-label="YouTube">
        <svg xmlns="http://www.w3.org/2000/svg" class="youtube-icon" viewBox="0 0 24 24">
          <path fill="#FF0000" d="M23.5 6.2c-.3-1.3-1.3-2.2-2.6-2.4C18.6 3.5 12 3.5 12 3.5s-6.6 0-8.9.3C1.8 4 0.8 4.9 0.5 6.2 0.2 8.1 0 10 0 12s.2 3.9.5 5.8c.3 1.3 1.3 2.2 2.6 2.4C5.4 20.5 12 20.5 12 20.5s6.6 0 8.9-.3c1.3-.2 2.3-1.1 2.6-2.4.3-1.9.5-3.8.5-5.8s-.2-3.9-.5-5.8zM9.6 15.5V8.5l6.4 3.5-6.4 3.5z"/>
        </svg>
      </a>
      <a href="https://github.com/gitterkorso" target="_blank" id="github-link" aria-label="GitHub">
        <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path fill="#000" d="M12 .5C5.7.5.5 5.7.5 12c0 5.1 3.3 9.5 7.9 11.1.6.1.8-.3.8-.6v-2.1c-3.2.7-3.9-1.4-3.9-1.4-.5-1.2-1.1-1.5-1.1-1.5-.9-.6.1-.6.1-.6 1 .1 1.5 1 1.5 1 .9 1.5 2.4 1.1 3 .9.1-.7.4-1.1.7-1.3-2.6-.3-5.3-1.3-5.3-5.8 0-1.3.5-2.3 1.2-3.1-.1-.3-.5-1.5.1-3.2 0 0 1-.3 3.2 1.2a11.1 11.1 0 0 1 5.8 0C17.9 6 19 6.3 19 6.3c.6 1.7.2 2.9.1 3.2.7.8 1.2 1.8 1.2 3 0 4.5-2.7 5.5-5.3 5.8.4.3.8 1 .8 2.1v3c0 .3.2.7.8.6A11.5 11.5 0 0 0 23.5 12C23.5 5.7 18.3.5 12 .5z"/>
        </svg>
      </a>
      <a href="https://www.linkedin.com/in/nick-westin-44b590369/" target="_blank" id="linkedin-link" aria-label="LinkedIn">
        <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path fill="#0077B5" d="M19 0h-14c-2.8 0-5 2.2-5 5v14c0 2.8 2.2 5 5 5h14c2.8 0 5-2.2 5-5v-14c0-2.8-2.2-5-5-5zm-11 19h-3v-9h3v9zm-1.5-10.3c-1 0-1.7-.8-1.7-1.7 0-1 .8-1.7 1.7-1.7s1.7.8 1.7 1.7c0 .9-.8 1.7-1.7 1.7zm13.5 10.3h-3v-4.7c0-1.1 0-2.4-1.5-2.4s-1.7 1.2-1.7 2.3v4.8h-3v-9h2.9v1.2h.1c.4-.8 1.4-1.5 2.9-1.5 3.1 0 3.7 2 3.7 4.6v4.7z"/>
        </svg>
      </a>
    </div>
    <div class="lang-switcher">
      <button id="flag-sv" class="lang-flag" aria-label="Svenska">
        <img src="https://flagcdn.com/se.svg" alt="Svenska" />
      </button>
      <button id="flag-en" class="lang-flag" aria-label="English">
        <img src="https://flagcdn.com/gb.svg" alt="English" />
      </button>
    </div>
  <div id="clock" class="clock"></div>

  <h1 id="main-title"></h1>
  <h3 id="subtitle">Byggnadsingenjör student på KTH Stockholm</h3>

  <div class="date-today" id="date-today"></div>
    <div class="progress-label" id="progress-label">Studieprogression</div>
    <div class="progress-container">
      <div class="progress-bar" id="progress-bar">60%</div>
    </div>

  <nav>
      <button class="tablink" id="tab-about-me" onclick="openTab('about-me')">Om mig</button>
      <button class="tablink" id="tab-cv" onclick="openTab('cv')">CV och Personligt Brev</button>
      <button class="tablink" id="tab-projekt" onclick="openTab('projekt')">Projekt</button>
      <button class="tablink" id="tab-program" onclick="openTab('program')">Program</button>
      <button class="tablink" id="tab-blogg" onclick="openTab('blogg')">Blogg</button>
      <button class="tablink" id="tab-pdf-merger" onclick="openTab('pdf-merger')">PDF Merger</button>
      <button class="tablink" id="tab-plot" onclick="openTab('plot')">Plot</button>
    </nav>

<section id="cv" class="tabcontent" style="display:none">
  <h2>CV och Personligt Brev</h2>
  <p id="cv-content">Du kan ladda ner eller öppna mitt CV och personliga brev här:</p>
  <div style="margin-bottom:1em;">
    <object data="cv.pdf" type="application/pdf" width="100%" height="600px" style="max-width:700px; width:100%; border:1px solid #bbb; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.07); display:block; margin:0 auto 1em auto;">
      <p>Det gick inte att visa PDF-filen. <a href="cv.pdf" target="_blank">Öppna CV (PDF)</a></p>
    </object>
  </div>
  <ul>
    <li><a href="cv.pdf" target="_blank" id="cv-link">Öppna CV (PDF)</a></li>
    <li><a href="#" id="personal-letter-link">Kommer snart</a></li>
  </ul>
</section>


  <section id="projekt" class="tabcontent" style="display:none">
    <h2>Projekt</h2>
    <p>Lista på projekt...</p>
  </section>

<section id="program" class="tabcontent" style="display:none">
      <h2>Moment of Inertia Calculator</h2>
      <p>Beräkna Iy och Iz (mm⁴) för en rektangel:</p>

      <label for="height">Höjd (h, mm):</label>
      <input type="number" id="height" />

      <label for="width">Bredd (b, mm):</label>
      <input type="number" id="width" />

      <button id="run-calc">Beräkna</button>

      <pre id="result">Iy: -\nIz: -</pre>
      <hr style="margin:2em 0;">
      <h2>Fritt upplagd balk – Max moment & nedböjning</h2>
      <p>Beräkna maximal moment och nedböjning för en fritt upplagd balk med jämnt utbredd last.</p>
      <label for="beam-length">Längd (L, m):</label>
      <input type="number" id="beam-length" step="0.01" min="0" />
      <label for="beam-load">Last (q, kN/m):</label>
      <input type="number" id="beam-load" step="0.01" min="0" />
      <label for="beam-e">Elasticitetsmodul (E, MPa):</label>
      <input type="number" id="beam-e" step="1" min="0" value="210000" />
      <label for="beam-i">Tröghetsmoment (I, mm⁴):</label>
      <input type="number" id="beam-i" step="1" min="0" />
      <button id="run-beam">Beräkna</button>
      <pre id="beam-result">Max moment: -\nMax nedböjning: -</pre>
    </section>

<section id="about-me" class="tabcontent" style="display:none">
  <h2>About Me</h2>
  <p>Hej! Jag heter Nick Westin och studerar till civilingenjör i samhällsbyggnad på KTH i Stockholm. Jag är särskilt intresserad av konstruktion, programmering och problemlösning. På fritiden gillar jag att lära mig nya saker, bygga projekt och träna.</p>
</section>

<section id="blogg" class="tabcontent" style="display:none">
  <h2>Blogg</h2>
  <p>Välkommen till bloggen! här händer lite allt möjligt!</p>
  <ul>
    <li><strong>22 juni 2025:</strong> Idag har jag snickrat skrivbord med farsan!<br><img src="22.jpg" alt="Skrivbord" style="max-width:300px; border-radius:8px; margin-top:8px;"></li>
    <li><strong>21 juni 2025:</strong> Idag skapade jag min första hemsida! (denna) och snickrade vidare med farsan samt fick prova köra farbror Fredriks nya maskin!<br>
      <div style="display:flex; gap:12px; margin-top:8px; flex-wrap:wrap;">
        <img src="21.jpg" alt="Mäktigt!" style="max-width:300px; border-radius:8px;">
        <img src="21.2.jpg" alt="Fler bilder" style="max-width:300px; border-radius:8px;">
      </div>
    </li>
  </ul>
</section>

<section id="pdf-merger" class="tabcontent" style="display:none">
  <h2>PDF Merger</h2>
  <p>Slå ihop flera PDF-filer direkt i webbläsaren. Ingen fil lämnar din dator!</p>
  <div id="pdf-dropzone" style="border:2px dashed #0077B5; border-radius:10px; padding:1.2em; margin-bottom:1em; background:#f7faff; text-align:center; transition:background 0.2s; cursor:pointer; color:#1a2a3a; font-weight:600; font-size:1.08em;">
    <strong>Dra och släpp PDF-filer här</strong>
    <br>
    <!-- input type="file" tas bort, men finns kvar i DOM (dolt) för JS -->
    <input type="file" id="pdf-files" accept="application/pdf" multiple style="display:none;" />
  </div>
  <button id="merge-pdf-btn">Slå ihop PDF:er</button>
  <a id="download-merged-pdf" style="display:none; margin-left:1em; font-weight:bold;" download="sammanfogad.pdf">Ladda ner sammanslagen PDF</a>
  <div id="pdf-merge-status" style="margin-top:1em; color:#0077B5;"></div>
</section>

<section id="plot" class="tabcontent" style="display:none">
  <h2>Plotta funktioner (matplotlib)</h2>
  <p>Ange en eller flera funktioner av x (t.ex. <code>sin(x)</code>, <code>x**2</code>, <code>exp(-x)*cos(2*x)</code>).<br>Separera flera funktioner med kommatecken.</p>
  <form id="plot-form" style="margin-bottom:1em;">
    <label for="plot-funcs">f(x):</label>
    <input type="text" id="plot-funcs" placeholder="t.ex. sin(x), x**2" style="width:60%;max-width:340px;">
    <label for="plot-xmin" style="margin-left:1em;">x från</label>
    <input type="number" id="plot-xmin" value="-10" style="width:70px;">
    <label for="plot-xmax">till</label>
    <input type="number" id="plot-xmax" value="10" style="width:70px;">
    <br>
    <label for="plot-xlabel" style="margin-left:0.5em;">x-label:</label>
    <input type="text" id="plot-xlabel" placeholder="x" style="width:90px;">
    <label for="plot-ylabel" style="margin-left:0.5em;">y-label:</label>
    <input type="text" id="plot-ylabel" placeholder="f(x)" style="width:90px;">
    <button type="submit" id="plot-btn" style="margin-left:1em;">Plotta</button>
  </form>
  <div id="plot-status" style="color:#0077B5; margin-bottom:0.7em;"></div>
  <img id="plot-img" style="max-width:100%; border:1px solid #bbb; border-radius:8px; display:none; background:#fff;" alt="Plot" />
  <a id="plot-download" href="#" download="plot.png" style="display:none; margin-top:0.7em; font-weight:bold; color:#0077B5; text-decoration:underline;">Ladda ner plot</a>
</section>

  <canvas id="fireworks-canvas"></canvas>
  <canvas id="draw-canvas"></canvas>
  <canvas id="particles-bg"></canvas>
  <div class="canvas-hint" id="canvas-hint">
    💡 Klicka för fyrverkeri! Klicka och dra för att rita på sidan.
  </div>
  <button class="clear-drawing-btn" id="clear-drawing-btn" title="Rensa ritning">Rensa ritning</button>

  <script>
    function updateClock() {
      const now = new Date();
      const time = now.toLocaleTimeString('sv-SE', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      document.getElementById('clock').textContent = time;
    }
    setInterval(updateClock, 1000);
    updateClock();

    function openTab(tabName) {
      const contents = document.querySelectorAll(".tabcontent");
      contents.forEach(el => {
        el.classList.remove("active");
        el.style.display = "none";
      });
      const tab = document.getElementById(tabName);
      tab.style.display = "block";
      // Trigger reflow for animation
      void tab.offsetWidth;
      tab.classList.add("active");
    }

    // Visa första fliken som standard
    openTab('about-me');

    let pyodideReadyPromise = null;
    async function loadPyodideAndPackages() {
      if (!pyodideReadyPromise) {
        pyodideReadyPromise = loadPyodide();
      }
      return pyodideReadyPromise;
    }

    // Moment of Inertia Calculator
    document.getElementById("run-calc").addEventListener("click", async function() {
      const h = parseFloat(document.getElementById("height").value);
      const b = parseFloat(document.getElementById("width").value);
      const resultElem = document.getElementById("result");
      if (isNaN(h) || isNaN(b)) {
        resultElem.textContent = "Felaktig inmatning.";
        return;
      }
      const pyodide = await loadPyodideAndPackages();
      pyodide.globals.set('h', h);
      pyodide.globals.set('b', b);
      const code = `Iy = (b * h ** 3) / 12\nIz = (h * b ** 3) / 12\nf'Iy: {Iy:.2f} mm⁴\\nIz: {Iz:.2f} mm⁴'`;
      try {
        const output = await pyodide.runPythonAsync(code);
        resultElem.textContent = output;
      } catch (e) {
        resultElem.textContent = "Fel: " + e;
      }
    });

    // Kalkylator för fritt upplagd balk
    document.getElementById("run-beam").addEventListener("click", function() {
      const L = parseFloat(document.getElementById("beam-length").value); // m
      const q = parseFloat(document.getElementById("beam-load").value); // kN/m
      const E = parseFloat(document.getElementById("beam-e").value); // MPa
      const I = parseFloat(document.getElementById("beam-i").value); // mm^4
      const resultElem = document.getElementById("beam-result");
      if (isNaN(L) || isNaN(q) || isNaN(E) || isNaN(I) || L <= 0 || q <= 0 || E <= 0 || I <= 0) {
        resultElem.textContent = "Felaktig inmatning.";
        return;
      }
      // Max moment: Mmax = q*L^2/8 (kNm)
      const Mmax = q * Math.pow(L, 2) / 8;
      // Max nedböjning: fmax = (5*q*L^4)/(384*E*I) (E i MPa, I i mm^4, q i kN/m, L i m)
      // Omvandla q till N/m, E till N/mm^2, I i mm^4, L till mm
      const qN = q * 1000; // N/m
      const Lmm = L * 1000; // mm
      const fmax = (5 * qN * Math.pow(Lmm, 4)) / (384 * E * I); // mm
      resultElem.textContent = `Max moment: ${Mmax.toFixed(2)} kNm\nMax nedböjning: ${fmax.toFixed(2)} mm`;
    });

    // PDF Merger-funktionalitet
    document.getElementById('merge-pdf-btn').addEventListener('click', async function() {
      const files = document.getElementById('pdf-files').files;
      const status = document.getElementById('pdf-merge-status');
      const downloadLink = document.getElementById('download-merged-pdf');
      if (!files.length) {
        status.textContent = 'Välj minst två PDF-filer.';
        downloadLink.style.display = 'none';
        return;
      }
      status.textContent = 'Slår ihop PDF:er...';
      try {
        const mergedPdf = await PDFLib.PDFDocument.create();
        for (let i = 0; i < files.length; i++) {
          const arrayBuffer = await files[i].arrayBuffer();
          const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
          const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
          copiedPages.forEach(page => mergedPdf.addPage(page));
        }
        const mergedBytes = await mergedPdf.save();
        const blob = new Blob([mergedBytes], { type: 'application/pdf' });
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.style.display = 'inline-block';
        status.textContent = 'Klar! Klicka på länken för att ladda ner.';
      } catch (e) {
        status.textContent = 'Fel vid sammanslagning: ' + e;
        downloadLink.style.display = 'none';
      }
    });

    // PDF Merger drag-and-drop
    (function() {
      const dropzone = document.getElementById('pdf-dropzone');
      const fileInput = document.getElementById('pdf-files');
      dropzone.addEventListener('dragover', function(e) {
        e.preventDefault();
        dropzone.style.background = '#e3f2fd';
        dropzone.style.borderColor = '#005580';
      });
      dropzone.addEventListener('dragleave', function(e) {
        dropzone.style.background = '#f7faff';
        dropzone.style.borderColor = '#0077B5';
      });
      dropzone.addEventListener('drop', function(e) {
        e.preventDefault();
        dropzone.style.background = '#f7faff';
        dropzone.style.borderColor = '#0077B5';
        const newFiles = Array.from(e.dataTransfer.files).filter(f => f.type === 'application/pdf');
        if (!newFiles.length) {
          document.getElementById('pdf-merge-status').textContent = 'Endast PDF-filer stöds.';
          return;
        }
        // Kombinera redan valda filer med nya, undvik dubbletter (baserat på namn + storlek)
        const currentFiles = Array.from(fileInput.files);
        const allFiles = [...currentFiles];
        newFiles.forEach(newFile => {
          if (!allFiles.some(f => f.name === newFile.name && f.size === newFile.size)) {
            allFiles.push(newFile);
          }
        });
        // Skapa en DataTransfer med alla filer
        const dt = new DataTransfer();
        allFiles.forEach(f => dt.items.add(f));
        fileInput.files = dt.files;
        document.getElementById('pdf-merge-status').textContent = allFiles.length + ' PDF-fil(er) valda.';
      });
      // Klick på dropzone öppnar filväljaren
      dropzone.addEventListener('click', function(e) {
        if (e.target === fileInput) return;
        fileInput.click();
      });
    })();

    // Plot-funktion med matplotlib via Pyodide
    (function() {
      const form = document.getElementById('plot-form');
      const funcsInput = document.getElementById('plot-funcs');
      const xminInput = document.getElementById('plot-xmin');
      const xmaxInput = document.getElementById('plot-xmax');
      const xlabelInput = document.getElementById('plot-xlabel');
      const ylabelInput = document.getElementById('plot-ylabel');
      const status = document.getElementById('plot-status');
      const img = document.getElementById('plot-img');
      const download = document.getElementById('plot-download');
      if (!form) return;
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        status.textContent = 'Ritar...';
        img.style.display = 'none';
        download.style.display = 'none';
        const funcs = funcsInput.value.split(',').map(f => f.trim()).filter(f => f.length > 0);
        const xmin = parseFloat(xminInput.value);
        const xmax = parseFloat(xmaxInput.value);
        const xlabel = xlabelInput.value.trim();
        const ylabel = ylabelInput.value.trim();
        if (!funcs.length) {
          status.textContent = 'Ange minst en funktion.';
          return;
        }
        if (isNaN(xmin) || isNaN(xmax) || xmin >= xmax) {
          status.textContent = 'Felaktigt x-intervall.';
          return;
        }
        try {
          const pyodide = await loadPyodideAndPackages();
          await pyodide.loadPackage(['matplotlib', 'numpy']);
          pyodide.runPython(`import matplotlib; matplotlib.use('AGG')`);
          pyodide.runPython(`import matplotlib.pyplot as plt; import numpy as np`);
          pyodide.runPython('plt.clf()');
          pyodide.runPython(`x = np.linspace(${xmin}, ${xmax}, 500)`);
          for (const f of funcs) {
            pyodide.runPython(`plt.plot(x, [${f} for x in x], label='${f}')`);
          }
          if (xlabel) pyodide.runPython(`plt.xlabel(r'''${xlabel}''')`);
          if (ylabel) pyodide.runPython(`plt.ylabel(r'''${ylabel}''')`);
          pyodide.runPython('plt.legend()');
          pyodide.runPython('plt.grid(True)');
          pyodide.runPython('plt.tight_layout()');
          pyodide.runPython('import io');
          pyodide.runPython('buf = io.BytesIO()');
          pyodide.runPython('plt.savefig(buf, format="png", dpi=120)');
          pyodide.runPython('buf.seek(0)');
          const base64 = pyodide.runPython('import base64; base64.b64encode(buf.getvalue()).decode()');
          img.src = 'data:image/png;base64,' + base64;
          img.style.display = 'block';
          download.href = img.src;
          download.style.display = 'inline-block';
          status.textContent = '';
        } catch (err) {
          status.textContent = 'Fel vid plotting: ' + err;
          img.style.display = 'none';
          download.style.display = 'none';
        }
      });
    })();

    // Språkväxling
    const translations = {
      sv: {
        'tab-about-me': 'Om mig',
        'tab-cv': 'CV och Personligt Brev',
        'tab-projekt': 'Projekt',
        'tab-program': 'Program',
        'tab-blogg': 'Blogg',
        'about-me-title': 'About Me',
        'about-me-content': 'Hej! Mitt namn är Nick och jag studerar till civilingenjör inom samhällsbyggnad med inriktning mot byggnadskonstruktör. Jag är särskillt intresserad av konstruktion, programmering och problemlösning. Mina hobbies inkluderar längdskidåkinng och alpin skidåkning. Men även små projekt som denna att koda denna hemsida och att snickra intresserar mig.',
        'blogg-title': 'Blogg',
        'blogg-content': 'Här kommer jag att dela lite allt möjligt från mitt liv',
        'blogg-posts': `<ul><li><strong>21 juni 2025:</strong> Idag fick jag prova farbror Fredriks maskin!<br><img src="21.jpg" alt="Projektbild" style="max-width:300px; border-radius:8px; margin-top:8px;"></li><li><strong>21 juni 2025:</strong> Första blogginlägget! Sidan har nu stöd för mörkt och ljust tema samt nya flikar.</li></ul>`,
        'cv-title': 'CV',
        'cv-content': 'Du kan ladda ner eller öppna mitt CV här:',
        'cv-link': 'Öppna CV (PDF)',
        'personal-letter-title': 'Personal Letter',
        'personal-letter-content': 'Du kan ladda ner eller öppna mitt CV här:',
        'personal-letter-link': 'Öppna personal letter (PDF)',
        'subtitle': 'Byggnadsingenjör student på KTH Stockholm',
      },
      en: {
        'tab-about-me': 'About Me',
        'tab-cv': 'CV & Personal Letter',
        'tab-projekt': 'Projects',
        'tab-program': 'Calculator',
        'tab-blogg': 'Blog',
        'about-me-title': 'About Me',
        'about-me-content': "Hi! My name is Nick and I am studying to become a civil engineer in civil engineering with a focus on structural engineering. I am especially interested in construction, programming, and problem solving. My hobbies include cross-country and alpine skiing. But I also enjoy small projects like coding this website and woodworking.",
        'blogg-title': 'Blog',
        'blogg-content': 'Here I will share thoughts, project updates, and tips about technology, studies, and engineering life.',
        'blogg-posts': '<ul><li><strong>June 21, 2025:</strong> First blog post! The site now supports dark and light theme and new tabs.</li></ul>',
        'cv-title': 'CV',
        'cv-content': 'You can download or open my CV here:',
        'cv-link': 'Open CV (PDF)',
        'personal-letter-title': 'Personal Letter',
        'personal-letter-content': 'You can download or open my personal letter here:',
        'personal-letter-link': 'Open personal letter (PDF)',
        'subtitle': 'Structural Engineering Student at KTH Stockholm',
      }
    };
    function setLanguage(lang) {
      // Flagga
      document.getElementById('flag-sv').classList.toggle('selected', lang === 'sv');
      document.getElementById('flag-en').classList.toggle('selected', lang === 'en');
      // Subtitle
      document.getElementById('subtitle').textContent = translations[lang]['subtitle'];
      // Tabbar
      document.getElementById('tab-about-me').textContent = translations[lang]['tab-about-me'];
      document.getElementById('tab-cv').textContent = translations[lang]['tab-cv'];
      document.getElementById('tab-projekt').textContent = translations[lang]['tab-projekt'];
      document.getElementById('tab-program').textContent = translations[lang]['tab-program'];
      document.getElementById('tab-blogg').textContent = translations[lang]['tab-blogg'];
      // About Me
      document.querySelector('#about-me h2').textContent = translations[lang]['about-me-title'];
      document.querySelector('#about-me p').textContent = translations[lang]['about-me-content'];
      // Blogg
      document.querySelector('#blogg h2').textContent = translations[lang]['blogg-title'];
      document.querySelector('#blogg p').textContent = translations[lang]['blogg-content'];
      // Ta INTE bort eller skriv över blogg-listan i HTML längre!
      // CV
      document.querySelector('#cv h2').textContent = translations[lang]['cv-title'];
      document.querySelector('#cv p').textContent = translations[lang]['cv-content'];
      document.querySelector('#cv a').textContent = translations[lang]['cv-link'];
    }
    // Förhindra fyrverkeri på språkflagga: använd capture och kontrollera eventkedjan
    function isFlag(el) {
      return el && el.classList && el.classList.contains('lang-flag');
    }
    // Ny funktion: kolla om elementet eller dess förälder är text (ej bara whitespace)
    function isTextOrContainsText(el) {
      while (el) {
        // Om det är knapp/länk/flagga, returnera false direkt (hanteras separat)
        if (el.tagName === 'BUTTON' || el.tagName === 'A' || (el.classList && el.classList.contains('lang-flag'))) return false;
        // Om det är ett element med synlig text (ej bara whitespace)
        if (el.nodeType === Node.ELEMENT_NODE) {
          // Kolla om någon av dess textnoder har synlig text
          for (let node of el.childNodes) {
            if (node.nodeType === Node.TEXT_NODE && node.textContent.trim().length > 0) {
              return true;
            }
          }
        }
        el = el.parentElement;
      }
      return false;
    }
    document.getElementById('flag-sv').addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      setLanguage('sv');
    });
    document.getElementById('flag-en').addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      setLanguage('en');
    });
    document.addEventListener('click', function(e) {
      let el = e.target;
      // Om det är en textnod, trigga INTE
      if (el.nodeType === 3) return;
      // Lista på element som ska IGNORERAS för fyrverkeri
      const ignoreTags = [
        'BUTTON','A','INPUT','SELECT','TEXTAREA','LABEL'
      ];
      // Lista på element som typiskt innehåller text
      const textTags = [
        'P','H1','H2','H3','H4','H5','H6','SPAN','LI','PRE','STRONG','EM','B','I','SMALL','MARK','CODE','CITE','BLOCKQUOTE','TD','TH','CAPTION','DT','DD'
      ];
      // Om du klickar på ett element som är i ignoreTags eller textTags, trigga INTE
      if (el.tagName && (ignoreTags.includes(el.tagName) || textTags.includes(el.tagName))) return;
      // Om du klickar på flagga, trigga INTE
      if (el.classList && el.classList.contains('lang-flag')) return;
      // Om du klickar på ett element som innehåller synlig text, trigga INTE
      if (el.innerText && el.innerText.trim().length > 0) return;
      // Om du klickar på ett område utan text, knapp, länk, input, etc – trigga
      if (typeof createFirework === 'function') {
        createFirework(e.clientX, e.clientY);
      }
    }, false);
    // Visa svenska som standard vid sidladdning
    window.addEventListener('DOMContentLoaded', function() {
      setLanguage('sv');
    });

    // Dagens datum (endast datum, uppe till höger)
    function updateDateToday() {
      const now = new Date();
      const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
      document.getElementById('date-today').textContent = now.toLocaleDateString('sv-SE', options);
    }
    updateDateToday();
    // Progress bar för studier (fast till 60%)
    document.getElementById('progress-bar').style.width = '60%';
    document.getElementById('progress-bar').textContent = '60%';

    // Fyrverkeri-effekt på klick där det inte är en knapp
    const canvas = document.getElementById('fireworks-canvas');
    const ctx = canvas.getContext('2d');
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    function randomColor() {
      const colors = ['#fff', '#ffec6e', '#6ec1e4', '#b06ee4', '#e46e6e', '#888', '#222'];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    function createFirework(x, y) {
      const particles = [];
      const count = 24 + Math.floor(Math.random() * 12);
      for (let i = 0; i < count; i++) {
        const angle = (Math.PI * 2 * i) / count;
        const speed = 2 + Math.random() * 2.5;
        particles.push({
          x, y,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          alpha: 1,
          color: randomColor(),
          size: 2 + Math.random() * 2
        });
      }
      let frame = 0;
      function animate() {
        ctx.globalCompositeOperation = 'lighter';
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let alive = false;
        for (const p of particles) {
          if (p.alpha > 0.05) {
            alive = true;
            ctx.globalAlpha = p.alpha;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fillStyle = p.color;
            ctx.fill();
            p.x += p.vx;
            p.y += p.vy;
            p.vx *= 0.97;
            p.vy *= 0.97;
            p.vy += 0.04; // gravity
            p.alpha *= 0.96;
          }
        }
        ctx.globalAlpha = 1;
        if (alive && frame < 60) {
          requestAnimationFrame(animate);
          frame++;
        } else {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
      }
      animate();
    }

    // Typningsanimering med vågeffekt för "Nick Westin"
    function waveTitle(text, el) {
      el.textContent = '';
      for (let i = 0; i < text.length; i++) {
        const span = document.createElement('span');
        span.textContent = text[i];
        span.className = 'wave-letter';
        span.style.setProperty('--i', i);
        el.appendChild(span);
      }
    }
    window.addEventListener('DOMContentLoaded', function() {
      const titleEl = document.getElementById('main-title');
      waveTitle('Nick Westin', titleEl);
    });

    // Rita-på-sidan-funktion (endast om man inte håller på en knapp/länk)
    const drawCanvas = document.getElementById('draw-canvas');
    const drawCtx = drawCanvas.getContext('2d');
    function resizeDrawCanvas() {
      drawCanvas.width = window.innerWidth;
      drawCanvas.height = window.innerHeight;
    }
    resizeDrawCanvas();
    window.addEventListener('resize', resizeDrawCanvas);

    let drawing = false;
    let lastX = 0, lastY = 0;
    function isButtonOrLink(el) {
      while (el) {
        if (el.tagName === 'BUTTON' || el.tagName === 'A') return true;
        el = el.parentElement;
      }
      return false;
    }
    document.addEventListener('mousedown', function(e) {
      if (isButtonOrLink(e.target)) return;
      drawing = true;
      drawCanvas.style.pointerEvents = 'auto';
      lastX = e.clientX;
      lastY = e.clientY;
    });
    document.addEventListener('mousemove', function(e) {
      if (!drawing) return;
      drawCtx.strokeStyle = '#6ec1e4';
      drawCtx.lineWidth = 3;
      drawCtx.lineCap = 'round';
      drawCtx.beginPath();
      drawCtx.moveTo(lastX, lastY);
      drawCtx.lineTo(e.clientX, e.clientY);
      drawCtx.stroke();
      lastX = e.clientX;
      lastY = e.clientY;
    });
    document.addEventListener('mouseup', function(e) {
      if (drawing) {
        drawing = false;
        drawCanvas.style.pointerEvents = 'none';
      }
    });
    // För touch
    document.addEventListener('touchstart', function(e) {
      if (isButtonOrLink(e.target)) return;
      const t = e.touches[0];
      drawing = true;
      drawCanvas.style.pointerEvents = 'auto';
      lastX = t.clientX;
      lastY = t.clientY;
    });
    document.addEventListener('touchmove', function(e) {
      if (!drawing) return;
      const t = e.touches[0];
      drawCtx.strokeStyle = '#6ec1e4';
      drawCtx.lineWidth = 3;
      drawCtx.lineCap = 'round';
      drawCtx.beginPath();
      drawCtx.moveTo(lastX, lastY);
      drawCtx.lineTo(t.clientX, t.clientY);
      drawCtx.stroke();
      lastX = t.clientX;
      lastY = t.clientY;
    }, {passive: false});
    document.addEventListener('touchend', function(e) {
      if (drawing) {
        drawing = false;
        drawCanvas.style.pointerEvents = 'none';
      }
    });
    // För rensa ritning knapp
    document.getElementById('clear-drawing-btn').addEventListener('click', function() {
      const drawCanvas = document.getElementById('draw-canvas');
      const ctx = drawCanvas.getContext('2d');
      ctx.clearRect(0, 0, drawCanvas.width, drawCanvas.height);
    });
    // Dölj hint efter 15 sekunder eller vid första interaktion
    function hideHint() {
      const hint = document.getElementById('canvas-hint');
      if (hint) hint.classList.add('hide');
    }
    setTimeout(hideHint, 15000);
    document.addEventListener('mousedown', hideHint, { once: true });
    document.addEventListener('touchstart', hideHint, { once: true });

    // Subtil partikeleffekt i bakgrunden
    const particlesCanvas = document.getElementById('particles-bg');
    const pCtx = particlesCanvas.getContext('2d');
    function resizeParticlesCanvas() {
      particlesCanvas.width = window.innerWidth;
      particlesCanvas.height = window.innerHeight;
    }
    resizeParticlesCanvas();
    window.addEventListener('resize', resizeParticlesCanvas);

    const PARTICLE_COUNT = 38;
    const COLORS = ['#6ec1e4', '#e46e6e', '#b06ee4', '#e4b06e', '#6ee4b0', '#fff', '#f1f1f1'];
    const particles = [];
    for (let i = 0; i < PARTICLE_COUNT; i++) {
      const angle = Math.random() * Math.PI * 2;
      particles.push({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        r: 8 + Math.random() * 16,
        color: COLORS[Math.floor(Math.random() * COLORS.length)],
        phase: Math.random() * Math.PI * 2,
        speed: 0.1 + Math.random() * 0.15,
        alpha: 0.2 + Math.random() * 0.5,
        angle: angle,
        radius: 18 + Math.random() * 32
      });
    }
    function animateParticles() {
      pCtx.clearRect(0, 0, particlesCanvas.width, particlesCanvas.height);
      for (const p of particles) {
        // Cirkulär långsam rörelse
        p.x += Math.cos(p.angle) * 0.08;
        p.y += Math.sin(p.angle) * 0.08;
        p.angle += (Math.random() - 0.5) * 0.01;
        // Fade in/out
        const t = (Date.now() / 1200 + p.phase) % (2 * Math.PI);
        const a = 0.18 + 0.32 * (0.5 + 0.5 * Math.sin(t));
        pCtx.globalAlpha = a * p.alpha;
        pCtx.beginPath();
        pCtx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        pCtx.fillStyle = p.color;
        pCtx.shadowColor = p.color;
        pCtx.shadowBlur = 16;
        pCtx.fill();
        pCtx.shadowBlur = 0;
      }
      pCtx.globalAlpha = 1;
      requestAnimationFrame(animateParticles);
    }
    animateParticles();
  </script>
</body>
</html>